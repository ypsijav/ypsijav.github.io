<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CINEMANIA!</title>
<style>
  body {
    font-family: Georgia, serif;
    margin: 0;
    padding: 20px;
  }
  .staff-pick {
    font-size: 1.2em;
    color: gold;
    margin-bottom: 10px;
  }
  .movie {
    margin-bottom: 20px;
	font-size: 12pt;  
  }
  .time {
    font-weight: bold;
  }
  .title {
	font-size: 16pt;
	font-weight: bold;
	font-style: italic;
	text-decoration: none;
	}
  .event {
	font-size: 16pt;
	font-weight: bold;
	text-decoration: none;


	}
	.title-link {
  text-decoration: none; /* Remove underline */
  /* Additional styling if needed */
}

</style>
</head>
<body>

<h1>CINEMANIA!</h1>

<!-- Container for movie listings -->
<div id="movieListings"></div>

<script>
  // Function to fetch CSV file and process its contents
  async function fetchMovieData() {
    try {
      const response = await fetch('listings.csv');
      const csvData = await response.text();
      const movies = parseCsv(csvData);
      renderMovieListings(movies);
    } catch (error) {
      console.error('Error fetching movie data:', error);
    }
  }
// Function to parse CSV data into an array of objects
function parseCsv(csvData) {
  const currentDate = new Date();
  const lines = csvData.trim().split('\n');
  const headers = lines[0].split(',');
  const movies = [];

  for (let i = 1; i < lines.length; i++) {
    const values = lines[i].split(',');
    const movie = {};

    for (let j = 0; j < headers.length; j++) {
      movie[headers[j].trim()] = values[j].trim();
    }

    // Convert dateText to a Date object for comparison
    const movieDate = new Date(movie.date);

    // Check if the movie date is later than or equal to today's date (comparing date part only)
    if (movieDate.getFullYear() > currentDate.getFullYear() ||
        (movieDate.getFullYear() === currentDate.getFullYear() &&
         movieDate.getMonth() > currentDate.getMonth()) ||
        (movieDate.getFullYear() === currentDate.getFullYear() &&
         movieDate.getMonth() === currentDate.getMonth() &&
         movieDate.getDate() >= currentDate.getDate())) {
      movies.push(movie);
    }
  }

  return movies;
}

// Function to check if two dates are the same day (comparing date part only)
function isSameDay(date1, date2) {
  return date1.getDate() === date2.getDate() &&
         date1.getMonth() === date2.getMonth() &&
         date1.getFullYear() === date2.getFullYear();
}


  // Function to generate HTML markup for a single movie listing

// Function to generate HTML markup for a single movie listing
function generateMovieListing(movie) {
  // Define the text for Staff Pick
  const staffPickText = 'Staff Pick';
  // Define stars for the Staff Pick decoration
  const stars = '★'.repeat(2); // Unicode character for a filled star

  // Check if the movie is marked as a staff pick
  const isStaffPick = movie.pick === 'TRUE';

  // Generate HTML markup with Staff Pick surrounded by stars if it's a staff pick
  const staffPickHTML = isStaffPick ? `<div class="time">${stars} ${staffPickText} ${stars}</div>` : '';

  // Generate HTML markup for the title with or without the link
  let titleHTML = '';
  if (movie.link) {
    titleHTML = `<div class="title"><a href="${movie.link}" target="_blank" class="title-link">${movie.title}</a></div> <div class="event"> ${movie.format} </div>`;
  } else {
    titleHTML = `<div class="title">${movie.title}</div><div class="event"> ${movie.format} </div>`;
  }

  // Generate HTML markup for the event with or without the link
  let eventHTML = '';
  if (movie.eventLink) {
    eventHTML = `<div class="event"><a href="${movie.eventLink}" target="_blank" class="event">${movie.event}</a></div>`;
  } else {
    eventHTML = `<div class="event">${movie.event}</div>`;
  }

  // Generate HTML markup for the rest of the movie listing
  const movieListingHTML = `
    <div class="movie">
      ${staffPickHTML}
      <div class="time">${movie.dateText} • ${movie.time} • ${movie.cost}</div>
      <div class="time">${movie.presenter}</div>
      ${eventHTML}
      ${titleHTML} 
      <div class="director">${movie.director ? `(${movie.director} ${movie.year})` : ''}</div>
      <div class="title">${movie.title2}</div>
      <div class="director">${movie.director2 ? `(${movie.director2} ${movie.year2})` : ''}</div>
      <div class="title">${movie.title3}</div>
      <div class="director">${movie.director3 ? `(${movie.director3} ${movie.year3})` : ''}</div>
      <div class="director">${movie.notes}</div>
      <div class="time">${movie.venue}</div>
    </div>
  `;

  return movieListingHTML;
}


  // Function to render movie listings on the webpage
  function renderMovieListings(movies) {
    const movieListingsContainer = document.getElementById('movieListings');
    movieListingsContainer.innerHTML = ''; // Clear existing content

    // Render each movie listing
    movies.forEach(movie => {
      const movieListingHTML = generateMovieListing(movie);
      movieListingsContainer.innerHTML += movieListingHTML;
    });
  }

  // Fetch movie data from CSV file and render movie listings
  fetchMovieData();
</script>

</body>
</html>
